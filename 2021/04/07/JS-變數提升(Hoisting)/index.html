<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="author" content="Chieh Liu"><title>JS-變數提升(Hoisting) | Chieh Liu&#39;s Blog</title><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><script src="/js/script.js"></script><script src="/js/tocbot.min.js"></script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Chieh Liu's Blog" type="application/atom+xml">
</head><body><div class="wrapper"><header><nav class="navbar"><div class="container"><div class="navbar-header header-logo"><a href="/">Chieh Liu&#39;s Blog</a></div><div class="menu navbar-right"><a class="menu-item" href="/archives">Posts</a> <a class="menu-item" href="/category">Categories</a> <a class="menu-item" href="/tag">Tags</a> <a class="menu-item" href="/about">About</a> <input id="switch_default" type="checkbox" class="switch_default"> <label for="switch_default" class="toggleBtn"></label></div></div></nav><nav class="navbar-mobile" id="nav-mobile"><div class="container"><div class="navbar-header"><div><a href="/">Chieh Liu&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a></div><div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div></div><div class="menu" id="mobile-menu"><a class="menu-item" href="/archives">Posts</a> <a class="menu-item" href="/category">Categories</a> <a class="menu-item" href="/tag">Tags</a> <a class="menu-item" href="/about">About</a></div></div></nav></header><script>var mobileBtn=function(){var e=document.getElementsByClassName("menu-toggle")[0],t=document.getElementById("mobile-menu");e.classList.contains("active")?(e.classList.remove("active"),t.classList.remove("active")):(e.classList.add("active"),t.classList.add("active"))}</script><div class="main"><div class="container"><div class="post-toc"><div class="tocbot-list"></div><div class="tocbot-list-menu"><a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a> <a onclick="go_top()">Back to top</a> <a onclick="go_bottom()">Go to bottom</a></div></div><script>function expand_toc(){var o=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:6,orderedList:!1,scrollSmooth:!0}),o.setAttribute("onclick","collapse_toc()"),o.innerHTML="Collapse all"}function collapse_toc(){var o=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0}),o.setAttribute("onclick","expand_toc()"),o.innerHTML="Expand all"}function go_top(){window.scrollTo(0,0)}function go_bottom(){window.scrollTo(0,document.body.scrollHeight)}document.ready((function(){tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0})}))</script><article class="post-wrap"><header class="post-header"><h1 class="post-title">JS-變數提升(Hoisting)</h1><div class="post-meta">Author: <a itemprop="author" rel="author" href="/">Chieh Liu</a> <span class="post-time">Date: <a href="#">April 7, 2021&nbsp;&nbsp;23:16:12</a> </span><span class="post-category">Category: <a href="/categories/Javascript/">Javascript</a></span></div></header><div class="post-content"><h2 id="基本的Hoisting行為"><a href="#基本的Hoisting行為" class="headerlink" title="基本的Hoisting行為"></a>基本的Hoisting行為</h2><p>Hoisting 的行為可以分為兩種:</p><ol><li>變數提升</li><li>函式提升</li></ol><ul><li>變數提升:</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(x);</span><br><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//印出結果:undefined</span></span><br></pre></td></tr></table></figure><p>從上面印出結果可以發現，還未宣告的x竟然印出結果是undefined，而不是 not defined就是Hoisting的作用之一</p><ul><li>函式提升:</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">logx();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logx</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(x)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 印出結果:1</span></span><br></pre></td></tr></table></figure><p>在宣告函式之前就呼叫函式卻可以正常輸出結果也是Hoisting的效果</p><h2 id="什麼是Hoisting"><a href="#什麼是Hoisting" class="headerlink" title="什麼是Hoisting"></a>什麼是Hoisting</h2><p>當你完全沒有宣告變數就印出時</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(v)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>會得到變數沒有定義的錯誤<br><img src="https://i.imgur.com/THEUqr0.png"></p><p>雖然程式是一行一行的讀取但是在JS裡面卻可以這樣寫</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(v);</span><br><span class="line"><span class="keyword">var</span> v</span><br></pre></td></tr></table></figure><p>得出結果是undefined，竟然沒有報錯，依照理解這邊應該也會報錯才對，這樣的現象就是Hositing<br><img src="https://i.imgur.com/Eihaubm.png"></p><p>第二行的 變數v 因為某些原因被提升到了最開頭，因此你可以把目前的程式碼想像成這樣:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v</span><br><span class="line"><span class="built_in">console</span>.log(v);</span><br></pre></td></tr></table></figure><p>這部分必須由JS引擎的行為來解釋，它並不是真的移動變數v到頂端！</p><h2 id="hoisting-只會提升宣告而非賦值"><a href="#hoisting-只會提升宣告而非賦值" class="headerlink" title="hoisting 只會提升宣告而非賦值"></a>hoisting 只會提升宣告而非賦值</h2><p>可以把 <code>var v = 5</code>理解成</p><ol><li>宣告 v</li><li>v = 5</li></ol><p>而Hoisting只會提升第一階段也就是宣告的部分</p><h3 id="範例解釋-一"><a href="#範例解釋-一" class="headerlink" title="範例解釋 一"></a>範例解釋 一</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(v);</span><br><span class="line"><span class="keyword">var</span> v = <span class="number">5</span>;</span><br><span class="line"><span class="comment">// 印出結果 是 undfined並不是5</span></span><br></pre></td></tr></table></figure><p>提升後可以想像成這樣:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v;</span><br><span class="line"><span class="built_in">console</span>.log(v);</span><br><span class="line">v = <span class="number">5</span>;</span><br><span class="line"><span class="comment">// 印出結果 是 undfined並不是5</span></span><br></pre></td></tr></table></figure><h3 id="範例解釋-二"><a href="#範例解釋-二" class="headerlink" title="範例解釋 二"></a>範例解釋 二</h3><p>這個輸出的內容會是什麼？</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">v</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(v)</span><br><span class="line">  <span class="keyword">var</span> v = <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line">test(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><p>因為傳進來的參數讓 v = 10所以可以這樣理解:</p><ol><li>var v = 10</li><li>var v 是因為下面的var v = 3的變數提升上來</li><li>這邊雖然因為變數提升上來了var v但是因為沒有重新賦值給v所以還是保持10這個結果</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">v</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> v = <span class="number">10</span></span><br><span class="line">  <span class="keyword">var</span> v</span><br><span class="line">  <span class="built_in">console</span>.log(v)</span><br><span class="line">  <span class="keyword">var</span> v = <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line">test(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 印出結果為 10</span></span><br></pre></td></tr></table></figure><h2 id="Hoisting函式優先級高於變數"><a href="#Hoisting函式優先級高於變數" class="headerlink" title="Hoisting函式優先級高於變數"></a>Hoisting函式優先級高於變數</h2><p>這邊印出的結果是[Function: a]，誠如最上面所解釋的Hoisting也支援函式宣告，並且可以從下方範例理解，函式的優先級高於變數，因此輸出的結果是函式本身而不是undfined</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a) </span><br><span class="line"><span class="keyword">var</span> a</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 印出結果: [Function: a]</span></span><br></pre></td></tr></table></figure><h2 id="Hoisting重點"><a href="#Hoisting重點" class="headerlink" title="Hoisting重點"></a>Hoisting重點</h2><ol><li>變數以及函式都會有提升發生</li><li>函式提升的優先級高於變數</li><li>要注意參數在函式內部的參與會給變數賦值</li><li>Hoisting只會提升宣告，不會提升賦值</li></ol><h1 id="let-跟-const-與-hoisting"><a href="#let-跟-const-與-hoisting" class="headerlink" title="let 跟 const 與 hoisting"></a>let 跟 const 與 hoisting</h1><blockquote><p>let 與 const 也有 hoisting 但沒有初始化為 undefined，而且在賦值之前試圖取值會發生錯誤(TDZ)。</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a) </span><br><span class="line"><span class="keyword">let</span> a</span><br><span class="line"><span class="comment">// ReferenceError: Cannot access &#x27;a&#x27; before initialization</span></span><br></pre></td></tr></table></figure><blockquote><p>In ECMAScript 2015, let bindings are not subject to Variable Hoisting, which means that let declarations do not move to the top of the current execution context. Referencing the variable in the block before the initialization results in a ReferenceError (contrary to a variable declared with var, which will just have the undefined value). The variable is in a “temporal dead zone” from the start of the block until the initialization is processed.</p></blockquote><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Statements/let#temporal_dead_zone_and_errors_with_let">MDN</a></p><h1 id="為什麼我們需要-hoisting？"><a href="#為什麼我們需要-hoisting？" class="headerlink" title="為什麼我們需要 hoisting？"></a>為什麼我們需要 hoisting？</h1><ul><li>為了解決function 的相互呼叫</li></ul><h2 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h2><ol><li>呼叫函式帶入參數10 loop(10)</li><li>進入函式loop內，10&gt;1 故 logEvenOrOdd(n=10-1)帶入9</li><li>呼叫logEvenOrOdd(9) - <strong>這邊就是相互呼叫如果沒有變數提升是做不到的！</strong></li><li>印出 9, 9除以2的餘數為1故為true 顯示’Odd’</li><li>重新呼叫一次loop(n)</li><li>反覆行為</li><li>.</li><li>.</li><li>.</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loop</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                logEvenOrOdd(--n)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">logEvenOrOdd</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(n, n % <span class="number">2</span> ? <span class="string">&#x27;Odd&#x27;</span> : <span class="string">&#x27;Even&#x27;</span>)</span><br><span class="line">            loop(n)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        loop(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><p>印出結果:</p><p><img src="https://i.imgur.com/HiwFsJW.png"></p><h1 id="Hoisting-到底是怎麼運作的？"><a href="#Hoisting-到底是怎麼運作的？" class="headerlink" title="Hoisting 到底是怎麼運作的？"></a>Hoisting 到底是怎麼運作的？</h1><h2 id="先簡單介紹一下執行背景-Execution-Contexts"><a href="#先簡單介紹一下執行背景-Execution-Contexts" class="headerlink" title="先簡單介紹一下執行背景 (Execution Contexts)"></a>先簡單介紹一下執行背景 (Execution Contexts)</h2><ul><li>是一段別人寫好的程式來驗證以及執行使用者的程式碼</li><li>管理程式碼執行的先後順序(也就是stack執行堆)</li><li>管理的內容不只是使用者撰寫的還有更多</li></ul><h2 id="Hoisting運作"><a href="#Hoisting運作" class="headerlink" title="Hoisting運作"></a>Hoisting運作</h2><p>簡單來說執行函式的時候就會創造執行背景，並且會依序做三件事前在函式執行之前:</p><p>Variable Object存在於EC環境內在裡面宣告的變數跟函式都會被加進 VO 裡面</p><ol><li>把參數放到 Variable Object 裡面並設定好值，傳什麼進來就是什麼，沒有值的設成 undefined(這部分也就是變數的預設值為undefined的原因)</li><li>把 function 宣告放到 Variable Object 裡，如果已經有同名的就覆蓋掉(這邊解釋function優先級高於變數的原因)</li><li>把變數宣告放到 Variable Object 裡，如果已經有同名的則忽略(變數提升只會提升宣告而不提升賦值的原因)</li></ol><h2 id="再理解一次Hoisting"><a href="#再理解一次Hoisting" class="headerlink" title="再理解一次Hoisting"></a>再理解一次Hoisting</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">v</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(v)</span><br><span class="line">  <span class="keyword">var</span> v = <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line">test(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><ol><li>第一個階段是進入 EC</li><li>建立 VO<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  v: <span class="number">10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>因為VO內部已經有V這個屬性了因此忽略 v = 3，所以不添增VO的內容</li><li>第二階段執行程式碼 印出結果: 10</li></ol><h1 id="參考文章"><a href="#參考文章" class="headerlink" title="參考文章:"></a>參考文章:</h1><p><a target="_blank" rel="noopener" href="https://blog.techbridge.cc/2018/11/10/javascript-hoisting/#post-comment-wrapper">我知道你懂 hoisting，可是你了解到多深？ by Huli</a></p></div><section class="post-copyright"></section><section class="post-tags"><div><span>Tag(s):</span> <span class="tag"><a href="/tags/Javascript/"># Javascript</a></span></div><div><a href="javascript:window.history.back();">back</a> <span>· </span><a href="/">home</a></div></section><section class="post-nav"><a class="prev" rel="prev" href="/2021/04/11/JS-%E9%96%89%E5%8C%85(Closure)/">JS-閉包(Closure)</a> <a class="next" rel="next" href="/2021/04/07/JS-%E4%BA%8B%E4%BB%B6%E7%9A%84%E4%B8%89%E5%A4%A7%E9%9A%8E%E6%AE%B5/">JS-事件的三大階段</a></section></article></div></div><footer id="footer" class="footer"><div class="copyright"><span>© Chieh Liu | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span></div></footer></div></body></html>