<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="author" content="Chieh Liu"><title>JS-The Weird Part Of Javascript - part 3(一萬字) | Chieh Liu&#39;s Blog</title><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><script src="/js/script.js"></script><script src="/js/tocbot.min.js"></script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Chieh Liu's Blog" type="application/atom+xml">
</head><body><div class="wrapper"><header><nav class="navbar"><div class="container"><div class="navbar-header header-logo"><a href="/">Chieh Liu&#39;s Blog</a></div><div class="menu navbar-right"><a class="menu-item" href="/archives">Posts</a> <a class="menu-item" href="/category">Categories</a> <a class="menu-item" href="/tag">Tags</a> <a class="menu-item" href="/about">About</a> <input id="switch_default" type="checkbox" class="switch_default"> <label for="switch_default" class="toggleBtn"></label></div></div></nav><nav class="navbar-mobile" id="nav-mobile"><div class="container"><div class="navbar-header"><div><a href="/">Chieh Liu&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a></div><div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div></div><div class="menu" id="mobile-menu"><a class="menu-item" href="/archives">Posts</a> <a class="menu-item" href="/category">Categories</a> <a class="menu-item" href="/tag">Tags</a> <a class="menu-item" href="/about">About</a></div></div></nav></header><script>var mobileBtn=function(){var e=document.getElementsByClassName("menu-toggle")[0],t=document.getElementById("mobile-menu");e.classList.contains("active")?(e.classList.remove("active"),t.classList.remove("active")):(e.classList.add("active"),t.classList.add("active"))}</script><div class="main"><div class="container"><div class="post-toc"><div class="tocbot-list"></div><div class="tocbot-list-menu"><a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a> <a onclick="go_top()">Back to top</a> <a onclick="go_bottom()">Go to bottom</a></div></div><script>function expand_toc(){var o=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:6,orderedList:!1,scrollSmooth:!0}),o.setAttribute("onclick","collapse_toc()"),o.innerHTML="Collapse all"}function collapse_toc(){var o=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0}),o.setAttribute("onclick","expand_toc()"),o.innerHTML="Expand all"}function go_top(){window.scrollTo(0,0)}function go_bottom(){window.scrollTo(0,document.body.scrollHeight)}document.ready((function(){tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0})}))</script><article class="post-wrap"><header class="post-header"><h1 class="post-title">JS-The Weird Part Of Javascript - part 3(一萬字)</h1><div class="post-meta">Author: <a itemprop="author" rel="author" href="/">Chieh Liu</a> <span class="post-time">Date: <a href="#">June 12, 2021&nbsp;&nbsp;11:22:21</a> </span><span class="post-category">Category: <a href="/categories/Javascript/">Javascript</a></span></div></header><div class="post-content"><h1 id="Immediately-Invoked-Function-Expressions-IIFE-s"><a href="#Immediately-Invoked-Function-Expressions-IIFE-s" class="headerlink" title="Immediately Invoked Function Expressions (IIFE)s"></a>Immediately Invoked Function Expressions (IIFE)s</h1><p>首先我們先來看看 :</p><ul><li>function statement</li><li>function expression</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// function statement</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;hello&#x27;</span> + name);</span><br><span class="line">&#125;</span><br><span class="line">greet(); <span class="comment">// invoke it </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//using a function expression</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> greetFunc = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;hello&#x27;</span> + name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">greetFunc();<span class="comment">// invoke it</span></span><br></pre></td></tr></table></figure><p>這兩個部分上面都有介紹過，主要區別在於是否有產生值</p><h2 id="IIFE-S"><a href="#IIFE-S" class="headerlink" title="(IIFE)S"></a>(IIFE)S</h2><p>接下來看看這個範例：</p><p>在創造這個函式的當下，就呼叫它，並且括號內可以放入參數使用，就同英文名字一樣，立即呼叫函式表達式 (IIFE)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> greeting = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello&#x27;</span> + name;</span><br><span class="line">&#125;(<span class="string">&#x27;john&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(greeting)</span><br></pre></td></tr></table></figure><p>印出結果會是</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//hello john</span></span><br></pre></td></tr></table></figure><h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><p>這邊我使用兩個簡單的範例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;I am a string&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    name:<span class="string">&#x27;john&#x27;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>這樣印出的結果並不會報錯</p><p>然而，當我們想要印出 function 時</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> greeting=<span class="string">&#x27;inside IIFE: hello&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(greeting +<span class="string">&#x27; &#x27;</span>+ name);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>卻會得到錯誤並且說明必須給 function statement 名字</p><p><img src="https://i.imgur.com/p4urka8.png"></p><p>所以要讓 function 像是其他純值以及物件一樣可以放置在程式碼中不報錯可以使用括號</p><p>這樣一來 syntax parser 就不會判定 function 必須入名字了</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> firstname = <span class="string">&#x27;john&#x27;</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> greeting=<span class="string">&#x27;inside IIFE: hello&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(greeting +<span class="string">&#x27; &#x27;</span>+ name);</span><br><span class="line">    </span><br><span class="line">&#125;)(<span class="string">&#x27;john&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以正常印出 <code>indside IIFE: hello john</code></p><p>最後面 invoke 的括號可以寫在大括號內或是外都可以，記得一個方式持續使用即可</p><h1 id="Framework-Aside-IIFEs-and-Safe-Code"><a href="#Framework-Aside-IIFEs-and-Safe-Code" class="headerlink" title="Framework Aside: IIFEs and Safe Code"></a>Framework Aside: IIFEs and Safe Code</h1><blockquote><p>IIFEs 內部的 EC 不會被外部環境影響，所以說它是安全的</p></blockquote><p><img src="https://i.imgur.com/JyJn5qb.png"></p><p>這邊的 Hola 並不會影響到 IIFEs 內部的程式碼，因此這邊印出來的內容會是</p><p><code>Hello John</code>，而不是 Hola</p><h2 id="從-IIFEs-內部影響-global-EC"><a href="#從-IIFEs-內部影響-global-EC" class="headerlink" title="從 IIFEs 內部影響 global EC"></a>從 IIFEs 內部影響 global EC</h2><p>可以從下方範例看到，這邊的全域變數 greeting 被 IIFEs 內部變操作影響到了其結果，透過傳入 window 為參數對其操作的結果</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> greeting = <span class="string">&#x27;hola&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> firstname = <span class="string">&#x27;john&#x27;</span>;</span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"><span class="built_in">global</span>,name</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">global</span>.greeting = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(greeting +<span class="string">&#x27; &#x27;</span>+ name);</span><br><span class="line">    </span><br><span class="line">&#125;(<span class="built_in">window</span>,firstname));</span><br></pre></td></tr></table></figure><p>印出結果</p><p><img src="https://i.imgur.com/qjDmgWn.png"></p><h1 id="Understanding-Closures"><a href="#Understanding-Closures" class="headerlink" title="Understanding Closures"></a>Understanding Closures</h1><blockquote><p>外部函式儘管已經被跳出執行堆，其變數還是可以被內部函式環境保留(當作 outer reference 使用)，也就是確保範圍鍊可以正常使用</p></blockquote><p>首先我來們觀察這段程式碼可以發現他 invoke 兩次，第一次傳入參數 Hi ，第二次因為 return 了下一個函式表達式所以可以再次傳入參數 Tony ，最後也沒有報錯正常印出</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params">whattosay</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">name</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(whattosay + <span class="string">&#x27; &#x27;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">greet(<span class="string">&#x27;Hi&#x27;</span>)(<span class="string">&#x27;Tony&#x27;</span>);</span><br></pre></td></tr></table></figure><p>印出結果：</p><p><img src="https://i.imgur.com/edkng8Z.png"></p><p>奇怪的事情發生了：</p><p>這邊我把 <code>greet()</code> 指派給 sayHi ，並且在使用 <code>sayHi(&#39;Tony&#39;)</code>，照理來說因為 sayHi 的 EC 執行完畢之後，就會跳出執行堆，因此這邊的 sayHi 執行結果應該是 undefined Tony ，奇怪的事情發生了，它卻正常執行印出了 Hi Tony</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params">whattosay</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">name</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(whattosay + <span class="string">&#x27; &#x27;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sayHi = greet(<span class="string">&#x27;Hi&#x27;</span>);</span><br><span class="line">sayHi(<span class="string">&#x27;Tony&#x27;</span>)</span><br></pre></td></tr></table></figure><p>印出結果：</p><p><img src="https://i.imgur.com/edkng8Z.png"></p><blockquote><p>這樣明明已經 EC 都已經彈出的狀態卻又把其變數保留的狀態就是 closures ，也就是ＪＳ引擎原生的特性</p></blockquote><h2 id="背後的原理"><a href="#背後的原理" class="headerlink" title="背後的原理"></a>背後的原理</h2><p>下圖說明了，當 <code>var sayHi = greet(&#39;Hi&#39;);</code> 執行完時，其實已經把當下的 EC 彈出了，只剩下 global EC<br><img src="https://i.imgur.com/e2omTTN.png"></p><p>接下來執行下一行， <code>sayHi(&#39;Tony&#39;)</code> ，然而其創建的 EC 會保留他的 outer reference 也就是 whattosay 變數的內容，即使那個變數身處的 EC 已經消失，這就是 closure<br><img src="https://i.imgur.com/PclVUlw.png"></p><h1 id="Understanding-Closures-Part2"><a href="#Understanding-Closures-Part2" class="headerlink" title="Understanding Closures Part2"></a>Understanding Closures Part2</h1><p>這邊用一個經典的例子解釋 Closures</p><p>從這邊的程式碼會得出甚麼結果呢？</p><ol><li>建立一個 buildFunc 函式</li><li>創立空陣列 arr</li><li>使用 for loop 把匿名函式內容推進 arr 總共推了三次</li><li>函式會返回 arr 並且內部有三個匿名函式並且都會執行 <code>console.log(i)</code></li><li>把函式 buildFunc 指派給 fn</li><li>使用 <code>fn[i]()</code> 的方式呼叫被推進 arr 內的函式</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildFunctions</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    arr = [];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">        arr.push(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(i);</span><br><span class="line">        &#125;);    </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fs = buildFunctions();</span><br><span class="line"></span><br><span class="line">fs[<span class="number">0</span>]();</span><br><span class="line">fs[<span class="number">1</span>]();</span><br><span class="line">fs[<span class="number">2</span>]();</span><br></pre></td></tr></table></figure><h2 id="解釋背後發生什麼"><a href="#解釋背後發生什麼" class="headerlink" title="解釋背後發生什麼"></a>解釋背後發生什麼</h2><p>首先 JS 引擎讀取程式碼並且把它們放入全域環境中</p><p>全域環境中目前包含了</p><ul><li><code>buildFunctions()</code></li><li><code>var fs = buildFunctions()</code></li><li>三個<code>fs[]()</code></li></ul><p><img src="https://i.imgur.com/WEoq5Kk.png"></p><h3 id="下一步因為-buildFunctions-被執行了因此產生其執行背景-EC"><a href="#下一步因為-buildFunctions-被執行了因此產生其執行背景-EC" class="headerlink" title="下一步因為 buildFunctions () 被執行了因此產生其執行背景 EC"></a>下一步因為 buildFunctions () 被執行了因此產生其執行背景 EC</h3><p>在這段 EC 之中 for loop 跑完了並且要 return arr 時：</p><ul><li>i 的值跑到 3 之後跳出迴圈</li><li>arr 的值被推進去了三個匿名函式(這邊注意函式並沒有被執行)</li><li>從這邊可以理解 i 其實就是跑完 for loop 的結果也就是 3</li><li>arr 則是三個被推進去的匿名函式</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildFunctions</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    arr = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        arr.push(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(i);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(i), arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">buildFunctions();</span><br></pre></td></tr></table></figure><p>會得到</p><p><img src="https://i.imgur.com/F6Xk1wq.png"></p><h3 id="重點"><a href="#重點" class="headerlink" title="重點"></a>重點</h3><p>這個 EC 情況下記憶體中存在的 i 的值 以及 arr 的內容如下:</p><ul><li>i = 3</li><li>arr 內容長這樣<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">arr = [ </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//this is the first function pushed.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i); </span><br><span class="line">    &#125;,    </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//this is the second function pushed.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i); </span><br><span class="line">    &#125;,</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//this is the third function pushed.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i); </span><br><span class="line">    &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure></li></ul><p><img src="https://i.imgur.com/G4BrWvw.png"></p><h3 id="buildFunctions-函式執行結束"><a href="#buildFunctions-函式執行結束" class="headerlink" title="buildFunctions 函式執行結束"></a>buildFunctions 函式執行結束</h3><p>當 buildFunctions 函式執行結束，它的 EC 就會跳出，但是因為 JS Closures 的特性，它們的變數值會被當作 outer reference 被留下也就是3</p><p><img src="https://i.imgur.com/TuQvwYr.png"></p><h3 id="輪到執行-fs-i"><a href="#輪到執行-fs-i" class="headerlink" title="輪到執行 fs[i]()"></a>輪到執行 <code>fs[i]()</code></h3><p>照順序先從 <code>fs[0]()</code> 開始</p><ol><li>一樣一開始建立 EC</li><li>但是在這個 EC 中是沒有 變數 i 因此 scope chain 就會觸發</li><li>也就會去尋找它的 outer reference 也就是存在 buildFunctions 函式內部的 i = 3</li><li>因此印出結果是 3</li><li>執行結束後 EC 跳出</li><li>執行 <code>fs[1]()</code></li><li>以下以此類推……</li><li>由於他們的 outer reference 都是相同的因此印出的結果都是 3</li></ol><p><img src="https://i.imgur.com/EhkZnPq.png"></p><h2 id="如果不想要-Closures-發生呢"><a href="#如果不想要-Closures-發生呢" class="headerlink" title="如果不想要 Closures 發生呢"></a>如果不想要 Closures 發生呢</h2><h3 id="ES6-解法"><a href="#ES6-解法" class="headerlink" title="ES6 解法"></a>ES6 解法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildFunctions2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    arr = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> j = i;</span><br><span class="line"></span><br><span class="line">        arr.push(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(j);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fs2 = buildFunctions2();</span><br><span class="line"></span><br><span class="line">fs2[<span class="number">0</span>](); <span class="comment">//0</span></span><br><span class="line">fs2[<span class="number">1</span>](); <span class="comment">//1</span></span><br><span class="line">fs2[<span class="number">2</span>](); <span class="comment">//2</span></span><br></pre></td></tr></table></figure><p>使用 ES6 的語法 let 來操作:</p><p>因為 let 的作用域在大括號內，所以每次 for loop 執行時，都會有一個新的變數 j 存在記憶體中，也就會保留不同的 i 的值</p><h3 id="ES5解法"><a href="#ES5解法" class="headerlink" title="ES5解法"></a>ES5解法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildFunctions2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    arr = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        arr.push(</span><br><span class="line">            (<span class="function"><span class="keyword">function</span> (<span class="params">j</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;(i))</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fs2 = buildFunctions2();</span><br><span class="line"></span><br><span class="line">fs2[<span class="number">0</span>](); <span class="comment">//0</span></span><br><span class="line">fs2[<span class="number">1</span>](); <span class="comment">//1</span></span><br><span class="line">fs2[<span class="number">2</span>](); <span class="comment">//2</span></span><br></pre></td></tr></table></figure><p>這時候的 arr</p><p>變成三個立即函式</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">arr = [ </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//this is the first function pushed.</span></span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params">j</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;(i)),    </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//this is the second function pushed.</span></span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params">j</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;(i)),</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//this is the third function pushed.</span></span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params">j</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;(i))</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>因為 IIFEs 的關係(立即執行函式)一樣會產生三個不同的 EC 並且保留不同的 j 當作 <code>fs2[i]()</code> 的 outer reference 就可以達成印出結果不為 3</p><h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>這邊就是 Closures 確保我們內部的函式可以取用到值當我們在最底部(<code>fs[i]()</code>)執行它時，再好好的觀看上面的程式範例確保有看懂，那就表示你能理解 JS 進階的程式觀念</p><h1 id="Framework-Aside-Function-Factories"><a href="#Framework-Aside-Function-Factories" class="headerlink" title="Framework Aside: Function Factories"></a>Framework Aside: Function Factories</h1><blockquote><p>使用 closures 來為函式製造一些預設的變數<br>使用 closures 來製造 pattern 讓函式更方便</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeGreeting</span>(<span class="params">language</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">firstname, lastname</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(language ===<span class="string">&#x27;en&#x27;</span>)&#125;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;Hello&#x27;</span>, firstname+<span class="string">&#x27; &#x27;</span>+lastname);</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">if</span>(language ===<span class="string">&#x27;es&#x27;</span>)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;Hola&#x27;</span>, firstname+<span class="string">&#x27; &#x27;</span>+lastname);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> greetEnglish = makeGreeting(<span class="string">&#x27;en&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> greetSpanish = makeGreeting(<span class="string">&#x27;es&#x27;</span>);</span><br><span class="line"></span><br><span class="line">greetEnglish(<span class="string">&#x27;John&#x27;</span>,<span class="string">&#x27;Doe&#x27;</span>);</span><br><span class="line">greetSpanish(<span class="string">&#x27;John&#x27;</span>,<span class="string">&#x27;Doe&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>從 greetEnglish, greetSpanih 的指派中可以理解，因為各呼叫了一次因此產生了兩個 EC 並且留住了兩個變數 en, es 給下面的 invoke 使用，雖然它們兩個在執行的時候都是同一個函式，但是因為個別的 EC 以及個別的記憶體空間內容，讓 closures 可以抓到不一樣的變數內容</p><p>於是我們執行得出的結果是</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hello John Doe</span><br><span class="line">Hola John Doe</span><br></pre></td></tr></table></figure><p>這邊的 makeGreetin 函式，就是所謂的 factory function，我們利用 closures 的特性，讓內部的匿名函式可以取得到外部函式的 language 變數</p><p>接下來我創造出了 en, es 讓 makeGreeting 函式可以在指派給不同變數的情況下利用這些不同的參數，所以也可以創造比方說 CH, JP 等等的參數就可以重複利用這段程式碼達到 factory 的效果</p><h1 id="Closures-and-Callbacks"><a href="#Closures-and-Callbacks" class="headerlink" title="Closures and Callbacks"></a>Closures and Callbacks</h1><h2 id="setTimeout"><a href="#setTimeout" class="headerlink" title="setTimeout"></a>setTimeout</h2><ul><li><p>setTimeout 本身就是使用函式表達式把函式當作參數使用(first-class function 的一種特性)</p></li><li><p>因為 event loop 的操作會使得 web api 的內容在執行堆操作結束之後才會從 event queue 內部接下一個工作，因此 sayHiLater 會從執行堆彈出，但是因為 closures 的緣故，保留了變數 greeting 給 setTimeout 內的 console 使用</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHiLater</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> greeting = <span class="string">&#x27;Hi!&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(greeting);</span><br><span class="line">    &#125;,<span class="number">3000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sayHiLater();</span><br></pre></td></tr></table></figure><h2 id="jQuery"><a href="#jQuery" class="headerlink" title="jQuery"></a>jQuery</h2><p>在 click 部份一樣使用函式表達式把函式當作參數使用(first-class function 的一種特性)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// jQuery uses function expression and first-class functions !</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&#x27;button&#x27;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">do</span> something</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="callback-functions"><a href="#callback-functions" class="headerlink" title="callback functions"></a>callback functions</h2><blockquote><p>將函式作為參數傳遞到另一個函式時，被當作參數傳遞的那個函式我們稱之為回調函式 Callback function</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tellMeWhenDone</span>(<span class="params">callback</span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">2000</span>;</span><br><span class="line">    </span><br><span class="line">    callback();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tellMeWhenDone(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;I am done!&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">tellMeWhenDone(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;All done...&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="call-apply-and-bind"><a href="#call-apply-and-bind" class="headerlink" title="call(), apply() and bind()"></a>call(), apply() and bind()</h1><p>functions 是一種特殊的物件，包含</p><ul><li>name(可以匿名)</li><li>code 程式碼內容(可調用的 invocable)</li><li>call()</li><li>apply()</li><li>bind()</li></ul><p><img src="https://i.imgur.com/HCPJEFZ.png"></p><h2 id="bind-範例"><a href="#bind-範例" class="headerlink" title="bind() 範例"></a>bind() 範例</h2><p>從下方程式碼中 <code>logName()</code> 是會報錯的，因為裡面的 this 指向全域但是全域中卻沒有getFullname 這個 method ，會出現 this.getfullname is not a function at logName</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> person =&#123;</span><br><span class="line">    firstname:<span class="string">&quot;John&quot;</span>,</span><br><span class="line">    lastname:<span class="string">&quot;Doe&quot;</span>,</span><br><span class="line">    getFullName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">          </span><br><span class="line">          <span class="keyword">var</span> fullname = <span class="built_in">this</span>.firstname + <span class="string">&#x27; &#x27;</span>+ <span class="built_in">this</span>.lastname;</span><br><span class="line">          <span class="keyword">return</span> fullname</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> logName = <span class="function"><span class="keyword">function</span>(<span class="params">lang1,lang2</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Loged:&#x27;</span>+ <span class="built_in">this</span>.getFullname());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">logName();</span><br></pre></td></tr></table></figure><p>這時就可以使用 <code>bind()</code></p><p>它會製造出一個複製的 function 並且讓括號內的參數變為 this 的指向</p><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>把 logName 綁訂到 person 物件上面改變 this 的指向到 person 身上，就能正確印出 John Doe 搂 !</p><p><strong>注意</strong>這邊 logName 沒有調用的緣故是把 function 當作物件使用 bind 這個方法，如果調用了則變成 logName 裡面的值則無法使用此方法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> logNameRights = logName.bind(person)</span><br><span class="line">logNameRights();</span><br></pre></td></tr></table></figure><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>也可以直接使用在 logName 後面直接使用 <code>bind(person)</code> 也能正確印出 John Doe</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> logName = <span class="function"><span class="keyword">function</span> (<span class="params">lang1, lang2</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Loged:&#x27;</span> + <span class="built_in">this</span>.getFullname());</span><br><span class="line">&#125;.bind(person);</span><br><span class="line"></span><br><span class="line">logName();</span><br></pre></td></tr></table></figure><h3 id="放入參數"><a href="#放入參數" class="headerlink" title="放入參數"></a>放入參數</h3><p>即使是操作 <code>bind()</code> 後，也還是可以帶入參數並且正確印出內容</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> logName = <span class="function"><span class="keyword">function</span> (<span class="params">lang1, lang2</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Loged:&#x27;</span> + <span class="built_in">this</span>.getFullname());</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Arguments:&#x27;</span>+ <span class="string">&#x27; &#x27;</span>+ lang1+<span class="string">&#x27; &#x27;</span>+lang2);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;--------------------------------&#x27;</span>);</span><br><span class="line">&#125;.bind(person);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> logNameRights = logName.bind(person);</span><br><span class="line">logNameRights(<span class="string">&#x27;en&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://i.imgur.com/8er2Xuh.png"></p><h2 id="call-範例"><a href="#call-範例" class="headerlink" title="call() 範例"></a><code>call()</code> 範例</h2><ul><li>相較於 <code>bind()</code> 的複製一個 function 操作</li><li><code>call()</code> 則是直接執行函式</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> logName = <span class="function"><span class="keyword">function</span> (<span class="params">lang1, lang2</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Loged:&#x27;</span> + <span class="built_in">this</span>.getFullname());</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Arguments:&#x27;</span> + <span class="string">&#x27; &#x27;</span> + lang1 + <span class="string">&#x27; &#x27;</span> + lang2);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;--------------------------------&#x27;</span>);</span><br><span class="line">&#125;.bind(person);</span><br><span class="line"></span><br><span class="line"> logName.call(person,<span class="string">&#x27;en&#x27;</span>,<span class="string">&#x27;es&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="apply-範例"><a href="#apply-範例" class="headerlink" title="apply() 範例"></a><code>apply()</code> 範例</h2><p>基本上跟 <code>call()</code> 是一樣的操作方式只是，參數的部分必須以陣列的方式放入</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> logName = <span class="function"><span class="keyword">function</span> (<span class="params">lang1, lang2</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Loged:&#x27;</span> + <span class="built_in">this</span>.getFullname());</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Arguments:&#x27;</span> + <span class="string">&#x27; &#x27;</span> + lang1 + <span class="string">&#x27; &#x27;</span> + lang2);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;--------------------------------&#x27;</span>);</span><br><span class="line">&#125;.bind(person);</span><br><span class="line"></span><br><span class="line"> logName.apply(person,[<span class="string">&#x27;en&#x27;</span>,<span class="string">&#x27;es&#x27;</span>]);</span><br></pre></td></tr></table></figure><h2 id="也可以使用-IIFEs-操作"><a href="#也可以使用-IIFEs-操作" class="headerlink" title="也可以使用 IIFEs 操作"></a>也可以使用 IIFEs 操作</h2><p>一樣可以印出結果</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">lang1, lang2</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Loged:&#x27;</span> + <span class="built_in">this</span>.getFullname());</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Arguments:&#x27;</span> + <span class="string">&#x27; &#x27;</span> + lang1 + <span class="string">&#x27; &#x27;</span> + lang2);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;--------------------------------&#x27;</span>);</span><br><span class="line">&#125;).apply(person, person, [<span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;es&#x27;</span>]);</span><br></pre></td></tr></table></figure><h2 id="實際應用"><a href="#實際應用" class="headerlink" title="實際應用"></a>實際應用</h2><h3 id="function-borrowing"><a href="#function-borrowing" class="headerlink" title="function borrowing"></a>function borrowing</h3><p>借用 function getFullName 從 person ，用來印出 person2 的全名 Jane Doe</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person2 = &#123;</span><br><span class="line">    firstname:<span class="string">&quot;Jane&quot;</span>,</span><br><span class="line">    lastname:<span class="string">&quot;Doe&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person.getFullName.apply(person2)); <span class="comment">// 當然也可以用 call</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="function-curring-只能操作在-bind"><a href="#function-curring-只能操作在-bind" class="headerlink" title="function curring (只能操作在 bind)"></a>function curring (只能操作在 bind)</h3><blockquote><p>創造一個 copy 的函式並且有著固定的預設參數</p></blockquote><p>已知 bind 內的第一個參數會是 this 的指向<br>之後的參數則為使用函式的固定參數</p><p>以下面程式碼為例:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> multiplyByTwo = multiply.bind(<span class="built_in">this</span>, <span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(multiplyByTwo(<span class="number">4</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> multiplyByThree = multiply.bind(<span class="built_in">this</span>, <span class="number">3</span>);</span><br><span class="line"><span class="built_in">console</span>.log(multiplyByThree(<span class="number">4</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>bind(this,2)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>則 a 為 2</p><p><code>bind(this,3)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>則 a 為 3</p><p>藉由這樣的方式固定操作函式的參數讓其固定就被稱作 function curring</p><h1 id="Functional-Programming"><a href="#Functional-Programming" class="headerlink" title="Functional Programming"></a>Functional Programming</h1></div><section class="post-copyright"></section><section class="post-tags"><div><span>Tag(s):</span> <span class="tag"><a href="/tags/Javascript/"># Javascript</a></span></div><div><a href="javascript:window.history.back();">back</a> <span>· </span><a href="/">home</a></div></section><section class="post-nav"><a class="next" rel="next" href="/2021/06/02/p/">JS- API 練習</a></section></article></div></div><footer id="footer" class="footer"><div class="copyright"><span>© Chieh Liu | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span></div></footer></div></body></html>