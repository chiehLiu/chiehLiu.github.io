<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="author" content="Chieh Liu"><title>JS-Async JS Crash Course | Chieh Liu&#39;s Blog</title><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><script src="/js/script.js"></script><script src="/js/tocbot.min.js"></script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Chieh Liu's Blog" type="application/atom+xml">
</head><body><div class="wrapper"><header><nav class="navbar"><div class="container"><div class="navbar-header header-logo"><a href="/">Chieh Liu&#39;s Blog</a></div><div class="menu navbar-right"><a class="menu-item" href="/archives">Posts</a> <a class="menu-item" href="/category">Categories</a> <a class="menu-item" href="/tag">Tags</a> <a class="menu-item" href="/about">About</a> <input id="switch_default" type="checkbox" class="switch_default"> <label for="switch_default" class="toggleBtn"></label></div></div></nav><nav class="navbar-mobile" id="nav-mobile"><div class="container"><div class="navbar-header"><div><a href="/">Chieh Liu&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a></div><div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div></div><div class="menu" id="mobile-menu"><a class="menu-item" href="/archives">Posts</a> <a class="menu-item" href="/category">Categories</a> <a class="menu-item" href="/tag">Tags</a> <a class="menu-item" href="/about">About</a></div></div></nav></header><script>var mobileBtn=function(){var e=document.getElementsByClassName("menu-toggle")[0],t=document.getElementById("mobile-menu");e.classList.contains("active")?(e.classList.remove("active"),t.classList.remove("active")):(e.classList.add("active"),t.classList.add("active"))}</script><div class="main"><div class="container"><div class="post-toc"><div class="tocbot-list"></div><div class="tocbot-list-menu"><a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a> <a onclick="go_top()">Back to top</a> <a onclick="go_bottom()">Go to bottom</a></div></div><script>function expand_toc(){var o=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:6,orderedList:!1,scrollSmooth:!0}),o.setAttribute("onclick","collapse_toc()"),o.innerHTML="Collapse all"}function collapse_toc(){var o=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0}),o.setAttribute("onclick","expand_toc()"),o.innerHTML="Expand all"}function go_top(){window.scrollTo(0,0)}function go_bottom(){window.scrollTo(0,document.body.scrollHeight)}document.ready((function(){tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0})}))</script><article class="post-wrap"><header class="post-header"><h1 class="post-title">JS-Async JS Crash Course</h1><div class="post-meta">Author: <a itemprop="author" rel="author" href="/">Chieh Liu</a> <span class="post-time">Date: <a href="#">December 8, 2020&nbsp;&nbsp;10:27:20</a> </span><span class="post-category">Category: <a href="/categories/Javascript/">Javascript</a></span></div></header><div class="post-content"><h1 id="Async-JS-Crash-Course"><a href="#Async-JS-Crash-Course" class="headerlink" title="Async JS Crash Course"></a>Async JS Crash Course</h1><hr><h2 id="tags-Javascript-relate"><a href="#tags-Javascript-relate" class="headerlink" title="tags: Javascript relate"></a>tags: Javascript relate</h2><h6 id="tags-Javascript"><a href="#tags-Javascript" class="headerlink" title="tags: Javascript"></a>tags: <code>Javascript</code></h6><h1 id="使用範例來理解Async-JS在什麼情況下適合作用"><a href="#使用範例來理解Async-JS在什麼情況下適合作用" class="headerlink" title="使用範例來理解Async JS在什麼情況下適合作用:"></a>使用範例來理解Async JS在什麼情況下適合作用:</h1><ul><li>取得post貼上DOM延遲一秒鐘</li><li>創造新的post花了兩秒鐘</li></ul><p>這樣會發生什麼情況?</p><p><img src="https://i.imgur.com/lW6aV3a.png"></p><p>DOM會先PO post上去不等新的post創造好，所以永遠更新不到新的post</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> posts = [&#123;</span><br><span class="line">        title: <span class="string">&#x27;Post One&#x27;</span>,</span><br><span class="line">        body: <span class="string">&#x27;This is post one&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        title: <span class="string">&#x27;Post Two&#x27;</span>,</span><br><span class="line">        body: <span class="string">&#x27;This is post two&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 把取得的post貼到DOM上面 延遲一秒鐘</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPost</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> output = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        posts.forEach(<span class="function">(<span class="params">post, index</span>) =&gt;</span> &#123;</span><br><span class="line">            output += <span class="string">`&lt;li&gt;<span class="subst">$&#123;post.title&#125;</span>&lt;/li&gt;`</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">document</span>.body.innerHTML = output;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//創造一個新的post丟上去花了兩秒鐘</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPost</span>(<span class="params">post</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        posts.push(post);</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getPost();</span><br><span class="line"></span><br><span class="line">createPost(&#123;</span><br><span class="line">    title: <span class="string">&#x27;Post Three&#x27;</span>,</span><br><span class="line">    body: <span class="string">&#x27;This is post Three&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="使用callback"><a href="#使用callback" class="headerlink" title="使用callback:"></a>使用callback:</h1><p>使用callback代表getPosts，這樣一來就會在創造好新的post之後才會觸發getPosts整個過程會在兩秒內完成</p><p>需要注意callback的寫法在呼叫函式的部分撰寫的callback不需要加上()要特別留意</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//創造一個新的post丟上去花了兩秒鐘</span></span><br><span class="line"><span class="comment">//這邊的callback就代表了getPosts所以必須等創造好了新的post之後</span></span><br><span class="line"><span class="comment">// getPost才會觸發也才會把取的的物件推上去DOM所以就可以顯示新的post搂!</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPost</span>(<span class="params">post, callback</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        posts.push(post);</span><br><span class="line">        callback();</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">createPost(&#123;</span><br><span class="line">    title: <span class="string">&#x27;Post Three&#x27;</span>,</span><br><span class="line">    body: <span class="string">&#x27;This is post Three&#x27;</span></span><br><span class="line">&#125;, getPosts)</span><br></pre></td></tr></table></figure><h1 id="使用promise"><a href="#使用promise" class="headerlink" title="使用promise:"></a>使用promise:</h1><ul><li>promise解決會呼叫resolve</li><li>promise錯誤則呼叫reject</li></ul><p>promise成功則會使用then()內部的函式順利的印出新的post<br><img src="https://i.imgur.com/Vc1kOWO.png"></p><p>promise失敗(改寫error變數成true)則會顯示錯誤訊息在console裡面<br>也可以使用<code>catch</code>方法抓取錯誤的內容<br><img src="https://i.imgur.com/s18nYiL.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPost</span>(<span class="params">post, </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果promise解決會呼叫resolve</span></span><br><span class="line">    <span class="comment">//如果promise錯誤則呼叫reject</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            posts.push(post);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解釋promise內部的兩個參數的判斷是如何運作</span></span><br><span class="line">            <span class="keyword">const</span> error = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!error) &#123;</span><br><span class="line">                resolve();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                reject(<span class="string">&#x27;Error: something went wrong&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">createPost(&#123;</span><br><span class="line">        title: <span class="string">&#x27;Post Three&#x27;</span>,</span><br><span class="line">        body: <span class="string">&#x27;This is post three&#x27;</span></span><br><span class="line">    &#125;).then(getPosts).catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err));</span><br></pre></td></tr></table></figure><h2 id="示範promise-all"><a href="#示範promise-all" class="headerlink" title="示範promise.all"></a>示範promise.all</h2><p>常常promise會不只一個，一個一個接then太累了，所以可以使用promise.all一次抓住一同使用.then就好瞜!</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="built_in">Promise</span>.resolve(<span class="string">&#x27;hello world&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> promise2 = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> promise3 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">2000</span>, <span class="string">&#x27;Goodbye&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all([promise1, promise2, promise3]).then(<span class="function"><span class="params">values</span> =&gt;</span> <span class="built_in">console</span>.log(values));</span><br></pre></td></tr></table></figure><p>最後.then的印出結果<br><img src="https://i.imgur.com/9yQSz0L.png"></p><h2 id="示範fetch-API-相關的promise寫法"><a href="#示範fetch-API-相關的promise寫法" class="headerlink" title="示範fetch API 相關的promise寫法"></a>示範fetch API 相關的promise寫法</h2><p>使用fetch抓取資料的話必須轉化格式所以在指派給變數的階段就要先.then轉換格式</p><p>這樣才可以在promise.all的階段被真正抓取到資料</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用兩個.then因為要轉換JSON格式</span></span><br><span class="line"><span class="keyword">const</span> promise4 = fetch(<span class="string">&#x27;https://jsonplaceholder.typicode.com/users&#x27;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> res.json());</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all([promise1, promise2, promise3, promise4]).then(<span class="function"><span class="params">values</span> =&gt;</span> <span class="built_in">console</span>.log(values));</span><br></pre></td></tr></table></figure><p>最後.then的印出結果<br><img src="https://i.imgur.com/8fI5g5T.png"></p><h2 id="使用async"><a href="#使用async" class="headerlink" title="使用async:"></a>使用async:</h2><p><code>await</code> 等待一個同步的過程或動作去完成後才去執行其他動作</p><p>等待createPost處理完內部的函式createPost後也就是創造新的post後，才會往getPosts去執行這樣就會顯示摟!</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPost</span>(<span class="params">post, </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            posts.push(post);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> error = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!error) &#123;</span><br><span class="line">                resolve();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                reject(<span class="string">&#x27;Error: something went wrong&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等待createPost處理完成後，才會往getPosts去執行</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">await</span> createPost(&#123;</span><br><span class="line">        title: <span class="string">&#x27;Post Three&#x27;</span>,</span><br><span class="line">        body: <span class="string">&#x27;This is post three&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    getPosts();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">init();</span><br></pre></td></tr></table></figure><h2 id="示範fetch-API-相關的async寫法"><a href="#示範fetch-API-相關的async寫法" class="headerlink" title="示範fetch API 相關的async寫法"></a>示範fetch API 相關的async寫法</h2><p>不只用.then一切都更乾淨好讀</p><p>一樣fetch都需要資料轉換，但是這邊從新指派一個變數處理比較特別</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchUsers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> fetch(<span class="string">&#x27;https://jsonplaceholder.typicode.com/users&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> res.json();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fetchUsers();</span><br></pre></td></tr></table></figure><p>fetch的資料印出:<br><img src="https://i.imgur.com/Xc4q0xs.png"></p></div><section class="post-copyright"></section><section class="post-tags"><div><span>Tag(s):</span> <span class="tag"><a href="/tags/Javascript/"># Javascript</a></span></div><div><a href="javascript:window.history.back();">back</a> <span>· </span><a href="/">home</a></div></section><section class="post-nav"><a class="prev" rel="prev" href="/2020/12/10/JS-AJAX%20Crash%20Course%20(Vanilla%20JavaScript)/">JS-AJAX Crash Course </a> <a class="next" rel="next" href="/2020/12/06/JS-Fetch%20API%20Introduction/">JS-Fetch API Introduction</a></section></article></div></div><footer id="footer" class="footer"><div class="copyright"><span>© Chieh Liu | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span></div></footer></div></body></html>